<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8"/>
	<title>맛있을지도</title>
  <link rel="stylesheet" href="/stylesheets/style.css" />
</head>
<body>
  <div id="kabar">맛있을지도</div>
  <div id="infoBox">
    <div id="infoTitle">Today is</div>
    <div id="infoContent">2021.12.03</div>
  </div>
	<div id="map" style="width:100%;height:100vh;"></div>
	<script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey=a354ab2a3d2020a2daaf26052a331a44"></script>
	<script type="text/javascript" src="/data/data.js"></script>
  <script>
		var container = document.getElementById('map');
		var options = {
			center: new kakao.maps.LatLng(37.53522230083388, 126.99451013643906),
			level: 3
		};

		var map = new kakao.maps.Map(container, options);

    var markerList = [];
    var infowindowList = [];
    
    
    for(var i in data) {
      var target = data[i];
      var latlng = new kakao.maps.LatLng(target.lat, target.lng);
      marker = new kakao.maps.Marker({
        map: map,
        position: latlng,
        icon: {
          content : "<div class='marker'></div>",
          //anchor : new kakao.maps.Point(12,12) //강의 infowindow생성준비
        }
      });

      var content = `<div class='infowindow_wrap>
        <div class='infowindow_title'>${target.title}</div>
        <div class='infowindow_content'>${target.content}</div>
        <div class='infowindow_date'>${target.date}</div>  
      </div>`

      var infowindow = new kakao.maps.InfoWindow({
        content: content, 
        backgroundColor : "#00ff0000",
        borderColor: "#00ff0000", 
        anchorSize: new kakao.maps.Size(0,0) 
      })

      markerList.push(marker);
      infowindowList.push(infowindow);
    }

    for (var i =0, ii=markerList.length; i<ii; i++){
      kakao.maps.event.addListener(map, "click", ClickMap(i));
      kakao.maps.event.addListener(markerList[i], "click", getClickHandler(i));
    }

    function ClickMap(i) {
      return function() {
        var infowindow = infowindowList[i];
        infowindow.close()
      }
    }

    function getClickHandler(i) {
      return function() {
        var marker = markerList[i];
        var infowindow = infowindowList[i];
        if(infowindow.getMap()){
          infowindow.close();
        } else {
          infowindow.open(map, marker)
        }
      }
    }
  
	</script>
</body>
</html>